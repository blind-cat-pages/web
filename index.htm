<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <main class="main">
        <video class="main-bg-video" autoplay="" loop="" muted="" playsinline="" poster="./assets/horizontal-bg.webp">
            <source src="./assets/elements/vertical/vertical-bg.mp4" type="video/mp4" media="(max-width: 990px)">
            <source src="./assets/elements/horizontal/horizontal-bg.mp4" type="video/mp4" media="(min-width: 991px)">
            Your browser does not support the video tag.
        </video>
        <section class="form_background">
            <div id="poster-container">
                <div id="cat-container">
                    <div id="cat-back" style="position: absolute; width: 100%; height: 100%;">
                        <div style="position: absolute;" class="layer" maxmovement="5" speed="2" inverse="true">
                            <img src="./assets/cat/EARS_LAYER.webp" style="width: 100%; height: auto;">
                            <label style="position: absolute"></label>
                        </div>
                        <div style="position: absolute;" class="layer" maxmovement="0" speed="0" inverse="true">
                            <img src="./assets/cat/HEAD_LAYER.webp" style="width: 100%; height: auto;">
                            <label style="position: absolute"></label>
                        </div>
                        <div style="position: absolute;" class="layer" maxmovement="2" speed="1" inverse="false">
                            <img src="./assets/cat/EYES_LAYER.webp" style="width: 100%; height: auto;">
                            <label style="position: absolute"></label>
                        </div>
                        <div style="position: absolute;" class="layer" maxmovement="5" speed="2" inverse="false">
                            <img src="./assets/cat/MUZZLE_LAYER.webp" style="width: 100%; height: auto;">
                            <label style="position: absolute"></label>
                        </div>
                    </div>
                    <div id="cat-front" style="position: absolute; width: 100%; height: 100%;">
                        <div style="position: absolute;" class="layer" maxmovement="5" speed="2" inverse="true">
                            <img src="./assets/cat/EARS_LAYER.webp" style="width: 100%; height: auto;">
                            <label style="position: absolute"></label>
                        </div>
                        <div style="position: absolute;" class="layer" maxmovement="0" speed="0" inverse="true">
                            <img src="./assets/cat/HEAD_LAYER.webp" style="width: 100%; height: auto;">
                            <label style="position: absolute"></label>
                        </div>
                        <div style="position: absolute;" class="layer" maxmovement="2" speed="1" inverse="false">
                            <img src="./assets/cat/EYES_LAYER.webp" style="width: 100%; height: auto;">
                            <label style="position: absolute"></label>
                        </div>
                        <div style="position: absolute;" class="layer" maxmovement="5" speed="2" inverse="false">
                            <img src="./assets/cat/MUZZLE_LAYER.webp" style="width: 100%; height: auto;">
                            <label style="position: absolute"></label>
                        </div>
                    </div>
                </div>
                <div id="about"></div>
                <div id="form-container">
                    <div id="name-field" class="input-field">
                        <input class="input-fill" type="text" name="name" autocomplete="name" required="">
                    </div>
                    <div id="email-field" class="input-field">
                        <input class="input-fill" type="email" name="email" autocomplete="email" required="">
                    </div>
                    <div id="message-field" class="input-field">
                        <textarea class="input-fill" name="message" rows="4" autocomplete="on" required=""></textarea>
                    </div>
                    <button id="submit-button">Submit</button>
                </div>
                <div id="link-container">

                </div>
            </div>
        </section>
    </main>

    <script type="text/javascript">
        // CAT
        const size = 100;
        const scale = size / 100;
        const layers = [];
        onLoad();
        function onLoad() {
            const layerElements = document.querySelectorAll('.layer');
            layerElements.forEach((layer) => {
                const layerData = {};
                const position = {
                    x: 0,
                    y: 0,
                };
                layerData.startPosition = position;
                layerData.position = position;
                layerData.maxMovement =
                    parseInt(layer.getAttribute('maxMovement')) * scale;
                layerData.speed = parseInt(layer.getAttribute('speed')) * scale;
                layerData.inverse = layer.getAttribute('inverse');
                layers.push(layerData);
                console.log(layerData);
                const img = layer.querySelector('img');
                img.style.width = size + '%';
                img.style.height = 'auto';
            });
        }

        window.addEventListener('mousemove', (event) => {
            const x = event.movementX;
            const y = event.movementY;
            const rawInput = vectorNormalize(x, y);
            MoveLayers(rawInput);
        });

        if (window.DeviceOrientationEvent) {
            window.addEventListener('deviceorientation', (event) => {
                // gamma: left-to-right tilt in degrees, range [-90,90]
                // beta: front-to-back tilt in degrees, range [-180,180]
                const gamma = event.gamma || 0;
                const beta = event.beta || 0;
                // Normalize to [-1,1]
                const x = gamma / 90;
                const y = beta / 180;
                const rawInput = vectorNormalize(x, y);
                MoveLayers(rawInput);
            });
        }

        function MoveLayers(position) {
            const layerElements = document.querySelectorAll('.layer');
            for (let i = 0; i < layers.length; i++) {
                const layer = layers[i];
                let speed = layer.speed;
                if (layer.inverse === 'true') {
                    speed = -layer.speed;
                }
                const input = vectorMultiply(position, speed);
                const rawPosition = vectorAdd(layer.position, input);
                let newPosition = vectorClampToDistance(
                    layer.startPosition,
                    rawPosition,
                    layer.maxMovement
                );
                layer.position = newPosition;
                const element = layerElements[i];
                //element.querySelector('label').innerText = `x: ${newPosition.x} y: ${newPosition.y}`;
                element.style.left = newPosition.x + 'px';
                element.style.top = newPosition.y + 'px';
            }
        }

        function vectorNormalize(x, y) {
            const length = Math.sqrt(x * x + y * y);
            if (length === 0) return { x: 0, y: 0 };
            return { x: x / length, y: y / length };
        }

        function vectorAdd(a, b) {
            return { x: a.x + b.x, y: a.y + b.y };
        }

        function vectorMultiply(a, b) {
            return { x: a.x * b, y: a.y * b };
        }

        function vectorClampToDistance(a, b, distance) {
            const dx = b.x - a.x;
            const dy = b.y - a.y;
            const length = Math.sqrt(dx * dx + dy * dy);
            if (length > distance) {
                return {
                    x: a.x + (dx / length) * distance,
                    y: a.y + (dy / length) * distance,
                };
            }
            return b;
        }

        // CF
        const form = document.getElementById('form');
        const result = document.getElementById('result');

        form.addEventListener('submit', function (e) {
            e.preventDefault();
            const formData = new FormData(form);
            const object = Object.fromEntries(formData);
            const json = JSON.stringify(object);
            result.innerHTML = 'Please wait...';

            fetch('https://api.web3forms.com/submit', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    Accept: 'application/json',
                },
                body: json,
            })
                .then(async (response) => {
                    let json = await response.json();
                    if (response.status == 200) {
                        result.innerHTML = 'Form submitted successfully';
                        result.classList.add('success');
                    } else {
                        console.log(response);
                        result.innerHTML = json.message;
                        result.classList.add('error');
                    }
                })
                .catch((error) => {
                    console.log(error);
                    result.innerHTML = 'Something went wrong!';
                })
                .then(function () {
                    form.reset();
                    setTimeout(() => {
                        result.style.display = 'none';
                    }, 3000);
                });
        });
    </script>
</body>

</html>